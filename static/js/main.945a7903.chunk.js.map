{"version":3,"sources":["util.ts","images.ts","share.ts","components/ImageToolbar.tsx","App.tsx","index.tsx"],"names":["uint8ArrayToString","input","len","length","res","i","String","fromCharCode","getJRESImageFromDataString","data","palette","qname","tilemapTile","sourceFile","getJRESImage","jresDataToBitmap","getJRESImageFromImageLiteral","literal","text","defaultPattern","replace","trim","rows","split","sprite","spriteWidth","r","row","rowValues","c","push","Math","max","spriteHeight","result","Bitmap","set","imageLiteralToBitmap","undefined","bitmap","width","height","base64EncodeBitmap","previewURI","bitmapToImageURI","qualifiedName","hexChars","bitmapToImageLiteral","fileType","get","f4EncodeImgCore","w","h","bpp","getPix","hex2","ptr","curr","shift","pushBits","n","j","toString","slice","hex","x","y","btoa","Uint8ClampedArray","parseInt","hexToUint8Array","x0","y0","buf","this","dataLength","col","value","index","coordToIndex","setCore","getCore","cell","floor","ceil","jresURL","atob","indexOf","magic","charCodeAt","out","mask","v","frame","colors","canvas","document","createElement","context","getContext","color","fillStyle","fillRect","toDataURL","arcadePalette","DEFAULT_JRES","ImageToolbar","props","_item","handleMessage","msg","type","loadJres","jresImage","message","autosaveJres","state","saving","getJres","setTimeout","postMessage","copyToClipboard","imageString","stubForCopy","setAttribute","style","position","left","body","appendChild","select","execCommand","removeChild","onClockwiseRotateButtonClick","_transformImpl","rotateClockwise","onCounterClockwiseRotateButtonClick","rotateCounterClockwise","onHorizontalFlipButtonClick","horizontalFlip","onVerticalFlipButtonClick","verticalFlip","storedJson","window","localStorage","getItem","storedItems","JSON","parse","item","addEventListener","removeEventListener","setItem","stringify","prevProps","prevState","transformer","id","className","title","onClick","React","Component","App","iframe","contentWindow","onMouseEnter","focus","getElementById","src","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.945a7903.chunk.js","sourcesContent":["/**\n * This file contains util functions taken directly from pxt-core and lightly modified\n */\n\nexport const IMAGE_MIME_TYPE = \"image/x-mkcd-f4\"\n\nexport function browserDownloadUInt8Array(buf: Uint8Array, name: string, contentType: string = \"application/octet-stream\", userContextWindow?: Window, onError?: (err: any) => void): string {\n    return browserDownloadBase64(btoa(uint8ArrayToString(buf)), name, contentType, userContextWindow, onError)\n}\n\nexport function browserDownloadText(text: string, filename: string) {\n    const encoded = btoa(text);\n    browserDownloadDataUri(toDownloadDataUri(encoded, \"text/plain\"), filename)\n}\n\nexport function isEdge(): boolean {\n    return !!navigator && /Edge/i.test(navigator.userAgent);\n}\n\nexport function isIE(): boolean {\n    return !!navigator && /Trident/i.test(navigator.userAgent);\n}\n\nexport function browserDownloadDataUri(uri: string, name: string) {\n    if (isEdge() || isIE()) {\n        //Fix for edge\n        let byteString = atob(uri.split(',')[1]);\n        let ia = stringToUint8Array(byteString);\n        let blob = new Blob([ia], { type: \"img/png\" });\n        window.navigator.msSaveOrOpenBlob(blob, name);\n    } else {\n        let link = <any>window.document.createElement('a');\n        if (typeof link.download == \"string\") {\n            link.href = uri;\n            link.download = name;\n            document.body.appendChild(link); // for FF\n            link.click();\n            document.body.removeChild(link);\n        } else {\n            document.location.href = uri;\n        }\n    }\n}\n\nexport function browserDownloadBase64(b64: string, name: string, contentType: string = \"application/octet-stream\", userContextWindow?: Window, onError?: (err: any) => void): string {\n    const saveBlob = (<any>window).navigator.msSaveOrOpenBlob;\n    const dataurl = toDownloadDataUri(b64, name);\n    try {\n        if (saveBlob) {\n            const b = new Blob([stringToUint8Array(atob(b64))], { type: contentType })\n            const result = (<any>window).navigator.msSaveOrOpenBlob(b, name);\n        } else browserDownloadDataUri(dataurl, name);\n    } catch (e) {\n        if (onError) onError(e);\n    }\n    return dataurl;\n}\n\nexport function toDownloadDataUri(b64: string, contentType: string): string {\n    let protocol = \"data\";\n    const dataurl = protocol + \":\" + contentType + \";base64,\" + b64\n    return dataurl;\n}\n\n// this will take lower 8 bits from each character\nexport function stringToUint8Array(input: string) {\n    let len = input.length;\n    let res = new Uint8Array(len)\n    for (let i = 0; i < len; ++i)\n        res[i] = input.charCodeAt(i) & 0xff;\n    return res;\n}\n\nexport function hexToUint8Array(hex: string) {\n    let r = new Uint8ClampedArray(hex.length >> 1);\n    for (let i = 0; i < hex.length; i += 2)\n        r[i >> 1] = parseInt(hex.slice(i, i + 2), 16)\n    return r\n}\n\nexport function uint8ArrayToString(input: ArrayLike<number>) {\n    let len = input.length;\n    let res = \"\"\n    for (let i = 0; i < len; ++i)\n        res += String.fromCharCode(input[i]);\n    return res;\n}\n\n\nconst unicodeES5IdentifierStart = [170, 170, 181, 181, 186, 186, 192, 214, 216, 246, 248, 705, 710, 721, 736, 740, 748, 748, 750, 750, 880, 884, 886, 887, 890, 893, 902, 902, 904, 906, 908, 908, 910, 929, 931, 1013, 1015, 1153, 1162, 1319, 1329, 1366, 1369, 1369, 1377, 1415, 1488, 1514, 1520, 1522, 1568, 1610, 1646, 1647, 1649, 1747, 1749, 1749, 1765, 1766, 1774, 1775, 1786, 1788, 1791, 1791, 1808, 1808, 1810, 1839, 1869, 1957, 1969, 1969, 1994, 2026, 2036, 2037, 2042, 2042, 2048, 2069, 2074, 2074, 2084, 2084, 2088, 2088, 2112, 2136, 2208, 2208, 2210, 2220, 2308, 2361, 2365, 2365, 2384, 2384, 2392, 2401, 2417, 2423, 2425, 2431, 2437, 2444, 2447, 2448, 2451, 2472, 2474, 2480, 2482, 2482, 2486, 2489, 2493, 2493, 2510, 2510, 2524, 2525, 2527, 2529, 2544, 2545, 2565, 2570, 2575, 2576, 2579, 2600, 2602, 2608, 2610, 2611, 2613, 2614, 2616, 2617, 2649, 2652, 2654, 2654, 2674, 2676, 2693, 2701, 2703, 2705, 2707, 2728, 2730, 2736, 2738, 2739, 2741, 2745, 2749, 2749, 2768, 2768, 2784, 2785, 2821, 2828, 2831, 2832, 2835, 2856, 2858, 2864, 2866, 2867, 2869, 2873, 2877, 2877, 2908, 2909, 2911, 2913, 2929, 2929, 2947, 2947, 2949, 2954, 2958, 2960, 2962, 2965, 2969, 2970, 2972, 2972, 2974, 2975, 2979, 2980, 2984, 2986, 2990, 3001, 3024, 3024, 3077, 3084, 3086, 3088, 3090, 3112, 3114, 3123, 3125, 3129, 3133, 3133, 3160, 3161, 3168, 3169, 3205, 3212, 3214, 3216, 3218, 3240, 3242, 3251, 3253, 3257, 3261, 3261, 3294, 3294, 3296, 3297, 3313, 3314, 3333, 3340, 3342, 3344, 3346, 3386, 3389, 3389, 3406, 3406, 3424, 3425, 3450, 3455, 3461, 3478, 3482, 3505, 3507, 3515, 3517, 3517, 3520, 3526, 3585, 3632, 3634, 3635, 3648, 3654, 3713, 3714, 3716, 3716, 3719, 3720, 3722, 3722, 3725, 3725, 3732, 3735, 3737, 3743, 3745, 3747, 3749, 3749, 3751, 3751, 3754, 3755, 3757, 3760, 3762, 3763, 3773, 3773, 3776, 3780, 3782, 3782, 3804, 3807, 3840, 3840, 3904, 3911, 3913, 3948, 3976, 3980, 4096, 4138, 4159, 4159, 4176, 4181, 4186, 4189, 4193, 4193, 4197, 4198, 4206, 4208, 4213, 4225, 4238, 4238, 4256, 4293, 4295, 4295, 4301, 4301, 4304, 4346, 4348, 4680, 4682, 4685, 4688, 4694, 4696, 4696, 4698, 4701, 4704, 4744, 4746, 4749, 4752, 4784, 4786, 4789, 4792, 4798, 4800, 4800, 4802, 4805, 4808, 4822, 4824, 4880, 4882, 4885, 4888, 4954, 4992, 5007, 5024, 5108, 5121, 5740, 5743, 5759, 5761, 5786, 5792, 5866, 5870, 5872, 5888, 5900, 5902, 5905, 5920, 5937, 5952, 5969, 5984, 5996, 5998, 6000, 6016, 6067, 6103, 6103, 6108, 6108, 6176, 6263, 6272, 6312, 6314, 6314, 6320, 6389, 6400, 6428, 6480, 6509, 6512, 6516, 6528, 6571, 6593, 6599, 6656, 6678, 6688, 6740, 6823, 6823, 6917, 6963, 6981, 6987, 7043, 7072, 7086, 7087, 7098, 7141, 7168, 7203, 7245, 7247, 7258, 7293, 7401, 7404, 7406, 7409, 7413, 7414, 7424, 7615, 7680, 7957, 7960, 7965, 7968, 8005, 8008, 8013, 8016, 8023, 8025, 8025, 8027, 8027, 8029, 8029, 8031, 8061, 8064, 8116, 8118, 8124, 8126, 8126, 8130, 8132, 8134, 8140, 8144, 8147, 8150, 8155, 8160, 8172, 8178, 8180, 8182, 8188, 8305, 8305, 8319, 8319, 8336, 8348, 8450, 8450, 8455, 8455, 8458, 8467, 8469, 8469, 8473, 8477, 8484, 8484, 8486, 8486, 8488, 8488, 8490, 8493, 8495, 8505, 8508, 8511, 8517, 8521, 8526, 8526, 8544, 8584, 11264, 11310, 11312, 11358, 11360, 11492, 11499, 11502, 11506, 11507, 11520, 11557, 11559, 11559, 11565, 11565, 11568, 11623, 11631, 11631, 11648, 11670, 11680, 11686, 11688, 11694, 11696, 11702, 11704, 11710, 11712, 11718, 11720, 11726, 11728, 11734, 11736, 11742, 11823, 11823, 12293, 12295, 12321, 12329, 12337, 12341, 12344, 12348, 12353, 12438, 12445, 12447, 12449, 12538, 12540, 12543, 12549, 12589, 12593, 12686, 12704, 12730, 12784, 12799, 13312, 19893, 19968, 40908, 40960, 42124, 42192, 42237, 42240, 42508, 42512, 42527, 42538, 42539, 42560, 42606, 42623, 42647, 42656, 42735, 42775, 42783, 42786, 42888, 42891, 42894, 42896, 42899, 42912, 42922, 43000, 43009, 43011, 43013, 43015, 43018, 43020, 43042, 43072, 43123, 43138, 43187, 43250, 43255, 43259, 43259, 43274, 43301, 43312, 43334, 43360, 43388, 43396, 43442, 43471, 43471, 43520, 43560, 43584, 43586, 43588, 43595, 43616, 43638, 43642, 43642, 43648, 43695, 43697, 43697, 43701, 43702, 43705, 43709, 43712, 43712, 43714, 43714, 43739, 43741, 43744, 43754, 43762, 43764, 43777, 43782, 43785, 43790, 43793, 43798, 43808, 43814, 43816, 43822, 43968, 44002, 44032, 55203, 55216, 55238, 55243, 55291, 63744, 64109, 64112, 64217, 64256, 64262, 64275, 64279, 64285, 64285, 64287, 64296, 64298, 64310, 64312, 64316, 64318, 64318, 64320, 64321, 64323, 64324, 64326, 64433, 64467, 64829, 64848, 64911, 64914, 64967, 65008, 65019, 65136, 65140, 65142, 65276, 65313, 65338, 65345, 65370, 65382, 65470, 65474, 65479, 65482, 65487, 65490, 65495, 65498, 65500,];\nconst unicodeES5IdentifierPart = [170, 170, 181, 181, 186, 186, 192, 214, 216, 246, 248, 705, 710, 721, 736, 740, 748, 748, 750, 750, 768, 884, 886, 887, 890, 893, 902, 902, 904, 906, 908, 908, 910, 929, 931, 1013, 1015, 1153, 1155, 1159, 1162, 1319, 1329, 1366, 1369, 1369, 1377, 1415, 1425, 1469, 1471, 1471, 1473, 1474, 1476, 1477, 1479, 1479, 1488, 1514, 1520, 1522, 1552, 1562, 1568, 1641, 1646, 1747, 1749, 1756, 1759, 1768, 1770, 1788, 1791, 1791, 1808, 1866, 1869, 1969, 1984, 2037, 2042, 2042, 2048, 2093, 2112, 2139, 2208, 2208, 2210, 2220, 2276, 2302, 2304, 2403, 2406, 2415, 2417, 2423, 2425, 2431, 2433, 2435, 2437, 2444, 2447, 2448, 2451, 2472, 2474, 2480, 2482, 2482, 2486, 2489, 2492, 2500, 2503, 2504, 2507, 2510, 2519, 2519, 2524, 2525, 2527, 2531, 2534, 2545, 2561, 2563, 2565, 2570, 2575, 2576, 2579, 2600, 2602, 2608, 2610, 2611, 2613, 2614, 2616, 2617, 2620, 2620, 2622, 2626, 2631, 2632, 2635, 2637, 2641, 2641, 2649, 2652, 2654, 2654, 2662, 2677, 2689, 2691, 2693, 2701, 2703, 2705, 2707, 2728, 2730, 2736, 2738, 2739, 2741, 2745, 2748, 2757, 2759, 2761, 2763, 2765, 2768, 2768, 2784, 2787, 2790, 2799, 2817, 2819, 2821, 2828, 2831, 2832, 2835, 2856, 2858, 2864, 2866, 2867, 2869, 2873, 2876, 2884, 2887, 2888, 2891, 2893, 2902, 2903, 2908, 2909, 2911, 2915, 2918, 2927, 2929, 2929, 2946, 2947, 2949, 2954, 2958, 2960, 2962, 2965, 2969, 2970, 2972, 2972, 2974, 2975, 2979, 2980, 2984, 2986, 2990, 3001, 3006, 3010, 3014, 3016, 3018, 3021, 3024, 3024, 3031, 3031, 3046, 3055, 3073, 3075, 3077, 3084, 3086, 3088, 3090, 3112, 3114, 3123, 3125, 3129, 3133, 3140, 3142, 3144, 3146, 3149, 3157, 3158, 3160, 3161, 3168, 3171, 3174, 3183, 3202, 3203, 3205, 3212, 3214, 3216, 3218, 3240, 3242, 3251, 3253, 3257, 3260, 3268, 3270, 3272, 3274, 3277, 3285, 3286, 3294, 3294, 3296, 3299, 3302, 3311, 3313, 3314, 3330, 3331, 3333, 3340, 3342, 3344, 3346, 3386, 3389, 3396, 3398, 3400, 3402, 3406, 3415, 3415, 3424, 3427, 3430, 3439, 3450, 3455, 3458, 3459, 3461, 3478, 3482, 3505, 3507, 3515, 3517, 3517, 3520, 3526, 3530, 3530, 3535, 3540, 3542, 3542, 3544, 3551, 3570, 3571, 3585, 3642, 3648, 3662, 3664, 3673, 3713, 3714, 3716, 3716, 3719, 3720, 3722, 3722, 3725, 3725, 3732, 3735, 3737, 3743, 3745, 3747, 3749, 3749, 3751, 3751, 3754, 3755, 3757, 3769, 3771, 3773, 3776, 3780, 3782, 3782, 3784, 3789, 3792, 3801, 3804, 3807, 3840, 3840, 3864, 3865, 3872, 3881, 3893, 3893, 3895, 3895, 3897, 3897, 3902, 3911, 3913, 3948, 3953, 3972, 3974, 3991, 3993, 4028, 4038, 4038, 4096, 4169, 4176, 4253, 4256, 4293, 4295, 4295, 4301, 4301, 4304, 4346, 4348, 4680, 4682, 4685, 4688, 4694, 4696, 4696, 4698, 4701, 4704, 4744, 4746, 4749, 4752, 4784, 4786, 4789, 4792, 4798, 4800, 4800, 4802, 4805, 4808, 4822, 4824, 4880, 4882, 4885, 4888, 4954, 4957, 4959, 4992, 5007, 5024, 5108, 5121, 5740, 5743, 5759, 5761, 5786, 5792, 5866, 5870, 5872, 5888, 5900, 5902, 5908, 5920, 5940, 5952, 5971, 5984, 5996, 5998, 6000, 6002, 6003, 6016, 6099, 6103, 6103, 6108, 6109, 6112, 6121, 6155, 6157, 6160, 6169, 6176, 6263, 6272, 6314, 6320, 6389, 6400, 6428, 6432, 6443, 6448, 6459, 6470, 6509, 6512, 6516, 6528, 6571, 6576, 6601, 6608, 6617, 6656, 6683, 6688, 6750, 6752, 6780, 6783, 6793, 6800, 6809, 6823, 6823, 6912, 6987, 6992, 7001, 7019, 7027, 7040, 7155, 7168, 7223, 7232, 7241, 7245, 7293, 7376, 7378, 7380, 7414, 7424, 7654, 7676, 7957, 7960, 7965, 7968, 8005, 8008, 8013, 8016, 8023, 8025, 8025, 8027, 8027, 8029, 8029, 8031, 8061, 8064, 8116, 8118, 8124, 8126, 8126, 8130, 8132, 8134, 8140, 8144, 8147, 8150, 8155, 8160, 8172, 8178, 8180, 8182, 8188, 8204, 8205, 8255, 8256, 8276, 8276, 8305, 8305, 8319, 8319, 8336, 8348, 8400, 8412, 8417, 8417, 8421, 8432, 8450, 8450, 8455, 8455, 8458, 8467, 8469, 8469, 8473, 8477, 8484, 8484, 8486, 8486, 8488, 8488, 8490, 8493, 8495, 8505, 8508, 8511, 8517, 8521, 8526, 8526, 8544, 8584, 11264, 11310, 11312, 11358, 11360, 11492, 11499, 11507, 11520, 11557, 11559, 11559, 11565, 11565, 11568, 11623, 11631, 11631, 11647, 11670, 11680, 11686, 11688, 11694, 11696, 11702, 11704, 11710, 11712, 11718, 11720, 11726, 11728, 11734, 11736, 11742, 11744, 11775, 11823, 11823, 12293, 12295, 12321, 12335, 12337, 12341, 12344, 12348, 12353, 12438, 12441, 12442, 12445, 12447, 12449, 12538, 12540, 12543, 12549, 12589, 12593, 12686, 12704, 12730, 12784, 12799, 13312, 19893, 19968, 40908, 40960, 42124, 42192, 42237, 42240, 42508, 42512, 42539, 42560, 42607, 42612, 42621, 42623, 42647, 42655, 42737, 42775, 42783, 42786, 42888, 42891, 42894, 42896, 42899, 42912, 42922, 43000, 43047, 43072, 43123, 43136, 43204, 43216, 43225, 43232, 43255, 43259, 43259, 43264, 43309, 43312, 43347, 43360, 43388, 43392, 43456, 43471, 43481, 43520, 43574, 43584, 43597, 43600, 43609, 43616, 43638, 43642, 43643, 43648, 43714, 43739, 43741, 43744, 43759, 43762, 43766, 43777, 43782, 43785, 43790, 43793, 43798, 43808, 43814, 43816, 43822, 43968, 44010, 44012, 44013, 44016, 44025, 44032, 55203, 55216, 55238, 55243, 55291, 63744, 64109, 64112, 64217, 64256, 64262, 64275, 64279, 64285, 64296, 64298, 64310, 64312, 64316, 64318, 64318, 64320, 64321, 64323, 64324, 64326, 64433, 64467, 64829, 64848, 64911, 64914, 64967, 65008, 65019, 65024, 65039, 65056, 65062, 65075, 65076, 65101, 65103, 65136, 65140, 65142, 65276, 65296, 65305, 65313, 65338, 65343, 65343, 65345, 65370, 65382, 65470, 65474, 65479, 65482, 65487, 65490, 65495, 65498, 65500,];\nconst reservedWords = [\"abstract\", \"any\", \"as\", \"break\",\n    \"case\", \"catch\", \"class\", \"continue\", \"const\", \"constructor\", \"debugger\",\n    \"declare\", \"default\", \"delete\", \"do\", \"else\", \"enum\", \"export\", \"extends\",\n    \"false\", \"finally\", \"for\", \"from\", \"function\", \"get\", \"if\", \"implements\",\n    \"import\", \"in\", \"instanceof\", \"interface\", \"is\", \"let\", \"module\", \"namespace\",\n    \"new\", \"null\", \"package\", \"private\", \"protected\", \"public\",\n    \"require\", \"global\", \"return\", \"set\", \"static\", \"super\", \"switch\",\n    \"symbol\", \"this\", \"throw\", \"true\", \"try\", \"type\", \"typeof\", \"var\", \"void\",\n    \"while\", \"with\", \"yield\", \"async\", \"await\", \"of\", \"Math\"];\n\n\nexport function escapeIdentifier(name: string): string {\n    if (!name) return '_';\n\n    let n = name.trim().replace(/\\s+/g, \"_\").replace(/[^a-zA-Z0-9_$]/g, a =>\n        isIdentifierPart(a.charCodeAt(0)) ? a : \"\");\n\n    if (n.length === 0 || reservedWords.indexOf(n) !== -1 || !isIdentifierStart(n.charAt(0))) {\n        n = \"_\" + n;\n    }\n\n    return n;\n}\n\nfunction isIdentifierPart(charCode: number) {\n    return lookupInUnicodeMap(charCode, unicodeES5IdentifierPart);\n}\n\nfunction isIdentifierStart(char: string) {\n    if (/[a-zA-Z_$]/.test(char)) return true;\n    return lookupInUnicodeMap(char.charCodeAt(0), unicodeES5IdentifierStart);\n}\n\nfunction lookupInUnicodeMap(code: number, map: number[]): boolean {\n    // Bail out quickly if it couldn't possibly be in the map.\n    if (code < map[0]) {\n        return false;\n    }\n\n    // Perform binary search in one of the Unicode range maps\n    let lo = 0;\n    let hi: number = map.length;\n    let mid: number;\n\n    while (lo + 1 < hi) {\n        mid = lo + (hi - lo) / 2;\n        // mid has to be even to catch a range's beginning\n        mid -= mid % 2;\n        if (map[mid] <= code && code <= map[mid + 1]) {\n            return true;\n        }\n\n        if (code < map[mid]) {\n            hi = mid;\n        }\n        else {\n            lo = mid + 2;\n        }\n    }\n\n    return false;\n}\n","import {hexToUint8Array, uint8ArrayToString} from \"./util\";\n\nexport interface JRESImage {\n    data: string; // Base64 encoded string of f4 encoded bytes\n    previewURI: string; // PNG data uri\n    width: number;\n    height: number;\n\n    qualifiedName?: string;\n    tilemapTile?: boolean;\n    sourceFile?: string;\n}\n\nexport interface ImageInfo {\n    width: number;\n    height: number;\n    pixels: Uint8ClampedArray;\n}\n\nexport async function getImageFromURIAsync(uri: string): Promise<ImageInfo | null> {\n    const loaded = await loadImageAsync(uri);\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = loaded.width;\n    canvas.height = loaded.height;\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return null;\n\n    ctx.drawImage(loaded, 0, 0);\n    const data = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n    return {\n        width: data.width,\n        height: data.height,\n        pixels: data.data\n    };\n}\n\nasync function loadImageAsync(uri: string): Promise<HTMLImageElement> {\n    return new Promise<HTMLImageElement>(resolve => {\n        const el = document.createElement(\"img\");\n        el.src = uri\n        el.onload = () => {\n            resolve(el)\n        };\n    })\n}\n\nexport async function getJRESImageFromUint8Array(buf: Uint8Array, palette: string[]): Promise<JRESImage | null> {\n    const encoded = btoa(uint8ArrayToString(buf));\n    const imageInfo = await getImageFromURIAsync(\"data:image/png;base64,\" + encoded);\n    if (imageInfo) {\n        const imageLit = imgEncodeImage(imageInfo, palette);\n        return await getJRESImageFromImageLiteral(imageLit, palette);\n    }\n    return null;\n}\n\nexport function getJRESImageFromDataString(data: string, palette: string[], qname?: string, tilemapTile?: boolean, sourceFile?: string): JRESImage {\n    const bitmap = jresDataToBitmap(data);\n\n    return getJRESImage(bitmap, palette, data, qname, tilemapTile, sourceFile)\n}\n\nexport function getJRESImageFromImageLiteral(literal: string, palette: string[], sourceFile?: string) {\n    const bitmap = imageLiteralToBitmap(literal);\n    return getJRESImage(bitmap, palette, undefined, undefined, undefined, sourceFile)\n}\n\n\nfunction getJRESImage(bitmap: Bitmap, palette: string[], data?: string, qname?: string, tilemapTile?: boolean, sourceFile?: string): JRESImage {\n    return {\n        width: bitmap.width,\n        height: bitmap.height,\n        data: data || base64EncodeBitmap(bitmap),\n        previewURI: bitmapToImageURI(bitmap, palette),\n        qualifiedName: qname,\n        tilemapTile,\n        sourceFile\n    }\n}\n\nexport function imgEncodeJRESImage(image: JRESImage) {\n    const bitmap = jresDataToBitmap(image.data);\n    return bitmapToImageLiteral(bitmap, \"typescript\");\n}\n\n\nconst hexChars = [\".\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\"];\n\nexport function bitmapToImageLiteral(bitmap: Bitmap, fileType: \"typescript\" | \"python\"): string {\n    let res = '';\n    switch (fileType) {\n        case \"python\":\n            res = \"img(\\\"\\\"\\\"\";\n            break;\n        default:\n            res = \"img`\";\n            break;\n    }\n\n    if (bitmap) {\n        for (let r = 0; r < bitmap.height; r++) {\n            res += \"\\n\"\n            for (let c = 0; c < bitmap.width; c++) {\n                res += hexChars[bitmap.get(c, r)] + \" \";\n            }\n        }\n    }\n\n    res += \"\\n\";\n\n    switch (fileType) {\n        case \"python\":\n            res += \"\\\"\\\"\\\")\";\n            break;\n        default:\n            res += \"`\";\n            break;\n    }\n\n    return res;\n}\n\n\n/**\n * Encodes the image in the image/mkcd-f4 format (used for the data attribute in jres files)\n * @param image\n * @param colors\n */\nexport function f4EncodeImage(image: ImageInfo, colors: string[]) {\n    const palette = colorsToNumbers(colors);\n\n    return f4EncodeImgCore(image.width, image.height, 4, (x, y) => {\n        const index = y * image.width + x;\n        return closestColor(image.pixels, index << 2, palette);\n    });\n}\n\n/**\n * Encodes the image as an img`` literal\n * @param image\n * @param colors\n */\nexport function imgEncodeImage(image: ImageInfo, colors: string[]) {\n    const palette = colorsToNumbers(colors);\n\n    return imgEncodeImgCore(image.width, image.height, (x, y) => {\n        const index = y * image.width + x;\n        return closestColor(image.pixels, index << 2, palette);\n    });\n}\n\nfunction colorsToNumbers(colors: string[]): number[][] {\n    const res: number[][] = [];\n    for (let i = 0; i < colors.length; i++) {\n        const color = parseColorString(colors[i]);\n        res.push([_r(color), _g(color), _b(color)]);\n    }\n    return res;\n}\n\n// use geometric distance on colors\nfunction scale(v: number) {\n    return v * v\n}\n\nfunction closestColor(buf: Uint8ClampedArray, pix: number, palette: number[][], alpha = true) {\n    if (alpha && buf[pix + 3] < 100)\n        return 0 // transparent\n    let mindelta = 0\n    let idx = -1\n    for (let i = alpha ? 1 : 0; i < palette.length; ++i) {\n        let delta = scale(palette[i][0] - buf[pix + 0]) + scale(palette[i][1] - buf[pix + 1]) + scale(palette[i][2] - buf[pix + 2])\n        if (idx < 0 || delta < mindelta) {\n            idx = i\n            mindelta = delta\n        }\n    }\n    return idx\n}\n\nfunction f4EncodeImgCore(w: number, h: number, bpp: number, getPix: (x: number, y: number) => number) {\n    let r = hex2(0xe0 | bpp) + hex2(w) + hex2(h) + \"00\"\n    let ptr = 4\n    let curr = 0\n    let shift = 0\n\n    let pushBits = (n: number) => {\n        curr |= n << shift\n        // eslint-disable-next-line\n        if (shift == 8 - bpp) {\n            r += hex2(curr)\n            ptr++\n            curr = 0\n            shift = 0\n        } else {\n            shift += bpp\n        }\n    }\n\n    for (let i = 0; i < w; ++i) {\n        for (let j = 0; j < h; ++j)\n            pushBits(getPix(i, j))\n        // eslint-disable-next-line\n        while (shift != 0)\n            pushBits(0)\n        if (bpp > 1) {\n            while (ptr & 3)\n                pushBits(0)\n        }\n    }\n\n    return r\n\n    function hex2(n: number) {\n        return (\"0\" + n.toString(16)).slice(-2)\n    }\n}\n\nfunction imgEncodeImgCore(w: number, h: number, getPix: (x: number, y: number) => number) {\n    let res = \"img`\\n    \"\n    for (let r = 0; r < h; r++) {\n        let row: number[] = []\n        for (let c = 0; c < w; c++) {\n            row.push(getPix(c, r));\n        }\n        res += row.map(n => n.toString(16)).join(\" \");\n        res += \"\\n    \"\n    }\n    res += \"`\";\n    return res;\n}\n\nfunction base64EncodeBitmap(bitmap: Bitmap) {\n    const hex = f4EncodeImgCore(bitmap.width, bitmap.height, 4, (x, y) => bitmap.get(x, y));\n    return btoa(uint8ArrayToString(hexToUint8Array(hex)))\n}\n\nfunction _r(color: number) { return (color >> 16) & 0xff }\nfunction _g(color: number) { return (color >> 8) & 0xff }\nfunction _b(color: number) { return color & 0xff }\n\nfunction parseColorString(color: string) {\n    if (color) {\n        if (color.length === 6) {\n            return parseInt(\"0x\" + color);\n        }\n        else if (color.length === 7) {\n            return parseInt(\"0x\" + color.substr(1));\n        }\n    }\n    return 0;\n}\n\n/**\n * 16-color sprite\n */\nexport class Bitmap {\n    protected buf: Uint8ClampedArray;\n\n    constructor(public width: number, public height: number, public x0 = 0, public y0 = 0, buf?: Uint8ClampedArray) {\n        this.buf = buf || new Uint8ClampedArray(this.dataLength());\n    }\n\n    set(col: number, row: number, value: number) {\n        if (col < this.width && row < this.height && col >= 0 && row >= 0) {\n            const index = this.coordToIndex(col, row);\n            this.setCore(index, value);\n        }\n    }\n\n    get(col: number, row: number) {\n        if (col < this.width && row < this.height && col >= 0 && row >= 0) {\n            const index = this.coordToIndex(col, row);\n            return this.getCore(index);\n        }\n        return 0;\n    }\n\n    protected coordToIndex(col: number, row: number) {\n        return col + row * this.width;\n    }\n\n    protected getCore(index: number) {\n        const cell = Math.floor(index / 2);\n        if (index % 2 === 0) {\n            return this.buf[cell] & 0xf;\n        }\n        else {\n            return (this.buf[cell] & 0xf0) >> 4;\n        }\n    }\n\n    protected setCore(index: number, value: number) {\n        const cell = Math.floor(index / 2);\n        if (index % 2 === 0) {\n            this.buf[cell] = (this.buf[cell] & 0xf0) | (value & 0xf);\n        }\n        else {\n            this.buf[cell] = (this.buf[cell] & 0x0f) | ((value & 0xf) << 4);\n        }\n    }\n\n    protected dataLength() {\n        return Math.ceil(this.width * this.height / 2);\n    }\n}\n\n\nexport function jresDataToBitmap(jresURL: string) {\n    let data = atob(jresURL.slice(jresURL.indexOf(\",\") + 1))\n    let magic = data.charCodeAt(0);\n    let w = data.charCodeAt(1);\n    let h = data.charCodeAt(2);\n\n    if (magic === 0x87) {\n        magic = 0xe0 | data.charCodeAt(1);\n        w = data.charCodeAt(2) | (data.charCodeAt(3) << 8);\n        h = data.charCodeAt(4) | (data.charCodeAt(5) << 8);\n        data = data.slice(4);\n    }\n\n    const out = new Bitmap(w, h);\n\n    let index = 4\n    if (magic === 0xe1) {\n        // Monochrome\n        let mask = 0x01\n        let v = data.charCodeAt(index++)\n        for (let x = 0; x < w; ++x) {\n            for (let y = 0; y < h; ++y) {\n                out.set(x, y, (v & mask) ? 1 : 0);\n                mask <<= 1\n                // eslint-disable-next-line\n                if (mask == 0x100) {\n                    mask = 0x01\n                    v = data.charCodeAt(index++)\n                }\n            }\n        }\n    }\n    else {\n        // Color\n        for (let x = 0; x < w; x++) {\n            for (let y = 0; y < h; y += 2) {\n                let v = data.charCodeAt(index++)\n                out.set(x, y, v & 0xf);\n                // eslint-disable-next-line\n                if (y != h - 1) {\n                    out.set(x, y + 1, (v >> 4) & 0xf);\n                }\n            }\n            while (index & 3) index++\n        }\n    }\n\n    return out;\n}\n\nfunction imageLiteralToBitmap(text: string, defaultPattern?: string): Bitmap {\n    // Strip the tagged template string business and the whitespace. We don't have to exhaustively\n    // replace encoded characters because the compiler will catch any disallowed characters and throw\n    // an error before the decompilation happens. 96 is backtick and 9 is tab\n    text = text.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:img)/g, \"\").trim();\n    // eslint-disable-next-line\n    text = text.replace(/^[\"`\\(\\)]*/, '').replace(/[\"`\\(\\)]*$/, '');\n    text = text.replace(/&#10;/g, \"\\n\");\n\n    if (!text && defaultPattern)\n        text = defaultPattern;\n\n    const rows = text.split(\"\\n\");\n\n    // We support \"ragged\" sprites so not all rows will be the same length\n    const sprite: number[][] = [];\n    let spriteWidth = 0;\n\n    for (let r = 0; r < rows.length; r++) {\n        const row = rows[r];\n        const rowValues: number[] = [];\n        for (let c = 0; c < row.length; c++) {\n            // This list comes from libs/screen/targetOverrides.ts in pxt-arcade\n            // Technically, this could change per target.\n            switch (row[c]) {\n                case \"0\": case \".\": rowValues.push(0); break;\n                case \"1\": case \"#\": rowValues.push(1); break;\n                case \"2\": case \"T\": rowValues.push(2); break;\n                case \"3\": case \"t\": rowValues.push(3); break;\n                case \"4\": case \"N\": rowValues.push(4); break;\n                case \"5\": case \"n\": rowValues.push(5); break;\n                case \"6\": case \"G\": rowValues.push(6); break;\n                case \"7\": case \"g\": rowValues.push(7); break;\n                case \"8\": rowValues.push(8); break;\n                case \"9\": rowValues.push(9); break;\n                case \"a\": case \"A\": case \"R\": rowValues.push(10); break;\n                case \"b\": case \"B\": case \"P\": rowValues.push(11); break;\n                case \"c\": case \"C\": case \"p\": rowValues.push(12); break;\n                case \"d\": case \"D\": case \"O\": rowValues.push(13); break;\n                case \"e\": case \"E\": case \"Y\": rowValues.push(14); break;\n                case \"f\": case \"F\": case \"W\": rowValues.push(15); break;\n            }\n        }\n\n        if (rowValues.length) {\n            sprite.push(rowValues);\n            spriteWidth = Math.max(spriteWidth, rowValues.length);\n        }\n    }\n\n    const spriteHeight = sprite.length;\n\n    const result = new Bitmap(spriteWidth, spriteHeight)\n\n    for (let r = 0; r < spriteHeight; r++) {\n        const row = sprite[r];\n        for (let c = 0; c < spriteWidth; c++) {\n            if (c < row.length) {\n                result.set(c, r, row[c]);\n            }\n            else {\n                result.set(c, r, 0);\n            }\n        }\n    }\n\n    return result;\n}\n\n/**\n * Converts a bitmap into a square image suitable for display\n */\nfunction bitmapToImageURI(frame: Bitmap, colors: string[]) {\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = frame.width;\n    canvas.height = frame.height;\n\n    let context = canvas.getContext(\"2d\");\n\n    if (context) {\n        for (let c = 0; c < frame.width; c++) {\n            for (let r = 0; r < frame.height; r++) {\n                const color = frame.get(c, r);\n\n                if (color) {\n                    context.fillStyle = colors[color];\n                    context.fillRect(c, r, 1, 1);\n                }\n            }\n        }\n    }\n\n\n    return canvas.toDataURL();\n}\n\n","import { getJRESImageFromDataString, getJRESImageFromImageLiteral, JRESImage } from \"./images\";\nimport { IMAGE_MIME_TYPE } from \"./util\";\n\nconst backendEndpoint = \"https://makecode.com/api\";\n\nexport interface JRes {\n    id: string; // something like \"sounds.bark\"\n    data: string;\n    dataEncoding?: string; // must be \"base64\" or missing (meaning the same)\n    icon?: string; // URL (usually data-URI) for the icon\n    namespace?: string; // used to construct id\n    mimeType: string;\n    tilemapTile?: boolean;\n    tileset?: string[];\n}\n\nexport const arcadePalette = [\n    \"#000000\",\n    \"#ffffff\",\n    \"#ff2121\",\n    \"#ff93c4\",\n    \"#ff8135\",\n    \"#fff609\",\n    \"#249ca3\",\n    \"#78dc52\",\n    \"#003fad\",\n    \"#87f2ff\",\n    \"#8e2ec4\",\n    \"#a4839f\",\n    \"#5c406c\",\n    \"#e5cdc4\",\n    \"#91463d\",\n    \"#000000\"\n];\n\n/*\n{\n    \"kind\": \"script\",\n    \"id\": \"62736-71028-62577-28752\",\n    \"shortid\": \"_UAVXEwU7RAew\",\n    \"time\": 1595883166,\n    \"name\": \"Untitled\",\n    \"description\": \"Made with ❤️ in Microsoft MakeCode Arcade.\",\n    \"target\": \"arcade\",\n    \"editor\": \"tsprj\",\n    \"meta\": {\n        \"versions\": {\n            \"branch\": \"v1.0.14\",\n            \"tag\": \"v1.0.14\",\n            \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/1460ac1c88950799eb51c9c297588c8abdc91077\",\n            \"target\": \"1.0.14\",\n            \"pxt\": \"6.1.41\"\n        },\n        \"blocksHeight\": 0,\n        \"blocksWidth\": 0\n    },\n    \"thumb\": false\n}\n*/\n\nexport interface ScriptMeta {\n    kind: \"script\";\n    id: string;\n    shortid: string;\n    time: number;\n    name: string;\n    description: string;\n    target: string;\n    editor: string;\n    meta: {\n        versions: {\n            branch: string;\n            tag: string;\n            commits: string;\n            target: string;\n            pxt: string;\n        };\n        blocksHeight: number;\n        blocksWidth: number;\n    };\n    thumb: boolean;\n}\n\nexport interface ScriptInfo {\n    meta: ScriptMeta;\n    files: {[index: string]: string};\n    customPalette?: string[];\n    images: JRESImage[];\n}\n\n\nexport async function fetchMakeCodeScriptAsync(url: string) {\n    // https://makecode.com/_UAVXEwU7RAew\n    // https://arcade.makecode.com/62736-71028-62577-28752\n    let scriptID = url.trim();\n\n    if (scriptID.indexOf(\"/\") !== -1) {\n        scriptID = scriptID.substr(scriptID.lastIndexOf(\"/\") + 1)\n    }\n\n    const meta: ScriptMeta = await httpGetJSONAsync(backendEndpoint + \"/\" + scriptID);\n\n    // A mapping of filenames to filecontents\n    const filesystem: {[index: string]: string} = await httpGetJSONAsync(backendEndpoint + \"/\" + scriptID + \"/text\");\n\n    const config = filesystem[\"pxt.json\"];\n\n    let palette = arcadePalette;\n    let paletteIsCustom = false;\n\n    if (config) {\n        try {\n            let parsedConfig = JSON.parse(config);\n\n            if (parsedConfig?.palette && Array.isArray(parsedConfig.palette)) {\n                palette = parsedConfig.palette.slice()\n                paletteIsCustom = true;\n            }\n        }\n        catch (e) {\n            // ignore\n        }\n    }\n\n    const projectImages = grabImagesFromProject(filesystem);\n\n    return {\n        meta,\n        files: filesystem,\n        projectImages: projectImages,\n        customPalette: paletteIsCustom ? palette : undefined\n    };\n}\n\n\nexport function grabImagesFromProject(filesystem: {[index: string]: string}, palette = arcadePalette) {\n    // Don't bother checking python and blocks files, they should all get converted to a matching ts\n    // file that will also contain all image literals\n    const typescriptFiles = Object.keys(filesystem).filter(filename =>\n        filename.endsWith(\".ts\") || filename.endsWith(\".jres\"));\n\n    // Grab any existing images in the project\n    const projectImages: JRESImage[] = [];\n    for (const filename of typescriptFiles) {\n\n        const fileText = filesystem[filename];\n        if (filename.endsWith(\"jres\")) {\n            projectImages.push(...grabImagesFromJRES(fileText, filename, palette));\n        }\n        else {\n            projectImages.push(...grabImagesFromTypeScript(fileText, filename, palette));\n        }\n    }\n\n    // Dedupe the images based on their content\n    const seenImages: {[index: string]: JRESImage} = {};\n\n    for (const image of projectImages) {\n        const existing = seenImages[image.data];\n        // Prefer images that have qualified names (from JRES)\n        if (!existing || (!existing.qualifiedName && image.qualifiedName)) {\n            seenImages[image.data] = image;\n        }\n    }\n\n    return Object.keys(seenImages).map(data => seenImages[data]);\n}\n\nfunction grabImagesFromJRES(jresText: string, filename: string, palette = arcadePalette): JRESImage[] {\n    let jres: {[index: string]: JRes | string};\n\n    try {\n        jres = JSON.parse(jresText);\n    }\n    catch (e) {\n        return [];\n    }\n\n    const metaEntry = jres[\"*\"] as JRes | undefined;\n\n    const metaMime = metaEntry?.mimeType || \"\";\n    const metaNamespace = metaEntry?.namespace || \"\";\n\n    const result: JRESImage[] = [];\n\n    for (const id of Object.keys(jres)) {\n        if (id === \"*\") continue;\n\n        let entry = jres[id];\n\n        if (typeof entry === \"string\") {\n            if (metaMime === IMAGE_MIME_TYPE) {\n                result.push(getJRESImageFromDataString(entry, palette, metaNamespace ? metaNamespace + \".\" + id : id, false, filename));\n            }\n        }\n        else if (entry.mimeType === IMAGE_MIME_TYPE) {\n            result.push(getJRESImageFromDataString(entry.data, palette, metaNamespace ? metaNamespace + \".\" + id : id, entry.tilemapTile, filename));\n        }\n    }\n\n    return result\n}\n\nfunction grabImagesFromTypeScript(fileText: string, filename: string, palette = arcadePalette) {\n    const literalRegex = /img\\s*`[\\s\\da-f.#tngrpoyw]*`/img;\n\n    const res: JRESImage[] = [];\n\n    fileText.replace(literalRegex, match => {\n        res.push(getJRESImageFromImageLiteral(match, palette, filename))\n        return \"\";\n    });\n\n    return res;\n}\n\n\nfunction httpGetJSONAsync(url: string): Promise<any> {\n    return new Promise((resolve, reject) => {\n        const request = new XMLHttpRequest();\n\n        request.addEventListener(\"error\", err => {\n            reject(err);\n        });\n\n        request.addEventListener(\"load\", () => {\n            try {\n                resolve(JSON.parse(request.responseText));\n            }\n            catch (e) {\n                reject(e);\n            }\n        });\n\n        request.open(\"GET\", url);\n        request.send();\n    });\n}","import React from 'react';\nimport {\n    Bitmap,\n    bitmapToImageLiteral,\n    getJRESImageFromDataString,\n    getJRESImageFromImageLiteral,\n    jresDataToBitmap,\n    JRESImage\n} from '../images'\nimport {arcadePalette} from '../share';\nimport '../styles/ImageToolbar.css';\n\ninterface ImageToolbarProps {\n    postMessage: (msg: any) => void;\n}\n\ninterface ImageToolbarState {\n    item: JRESImage;\n    saving?: number;\n}\n\nconst DEFAULT_JRES = {\n    data: \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n    previewURI: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAH0lEQVQ4T2NkoBAwUqifYdQAhtEwYBgNA1A+Gvi8AAAmmAARf9qcXAAAAABJRU5ErkJggg==\",\n    width: 16,\n    height: 16,\n}\n\nconst STORAGE_KEY = \"SPRITE_DATA\"\nconst SAVE_INTERVAL = 2000; // autosave every 2s\n\nclass ImageToolbar extends React.Component<ImageToolbarProps, ImageToolbarState> {\n    private _item: JRESImage;\n\n    constructor(props: ImageToolbarProps) {\n        super(props);\n\n        const storedJson = window.localStorage.getItem(STORAGE_KEY);\n        try {\n            const storedItems = storedJson && JSON.parse(storedJson) as JRESImage;\n            this._item = storedItems || {...DEFAULT_JRES};\n        } catch {\n            this._item = {...DEFAULT_JRES};\n        }\n\n        this.state = {\n            item: this._item,\n            saving: undefined\n        };\n    }\n\n    componentDidMount() {\n        window.addEventListener(\"message\", this.handleMessage);\n        this.loadJres(this._item);\n\n        // TODO: intermittent bug where floating layers are not registered\n        // in the \"update\" probably to do with pxt-side handling of getJres\n        setTimeout(this.autosaveJres, SAVE_INTERVAL);\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener(\"message\", this.handleMessage);\n        window.localStorage.setItem(STORAGE_KEY, JSON.stringify(this._item));\n    }\n\n    componentDidUpdate(prevProps: ImageToolbarProps, prevState: ImageToolbarState) {\n        // if (this.state.saving !== undefined && prevState.saving === undefined) {\n        //     this.getJres();\n        // }\n\n        window.localStorage.setItem(STORAGE_KEY, JSON.stringify(this._item));\n    }\n\n    handleMessage = (msg: any) => {\n        const data = msg.data;\n        switch (data.type) {\n            case \"ready\":\n                this.loadJres(this._item);\n                break;\n            case \"update\":\n                const jresImage = getJRESImageFromDataString(data.message, arcadePalette);\n                this._item = jresImage;\n                break;\n            default:\n                break;\n        }\n    }\n\n    autosaveJres = () => {\n        if (!this.state.saving) this.getJres();\n        setTimeout(this.autosaveJres, SAVE_INTERVAL);\n    }\n\n    loadJres = (jresImage: JRESImage) => {\n        this.props.postMessage({type: \"initialize\", message: jresImage.data});\n    }\n\n    getJres = () => {\n        this.props.postMessage({type: \"update\"});\n    }\n\n    copyToClipboard = () => {\n        let bitmap = jresDataToBitmap(this._item.data)\n        const imageString = bitmapToImageLiteral(bitmap, \"typescript\");\n\n        const stubForCopy = document.createElement('textarea');\n        stubForCopy.value = imageString;\n        stubForCopy.setAttribute('readonly', '');\n        stubForCopy.style.position = 'absolute';\n        stubForCopy.style.left = '-9999px';\n        document.body.appendChild(stubForCopy);\n        stubForCopy.select();\n        document.execCommand('copy');\n        document.body.removeChild(stubForCopy);\n    }\n\n    _transformImpl(transformer: (bitmap: Bitmap) => Bitmap) {\n        this.getJres()\n        setTimeout(() => {\n            // 1. rotate this._item.data;\n            let bitmap = jresDataToBitmap(this._item.data)\n\n            let result = transformer(bitmap)\n            const imageString = bitmapToImageLiteral(result, \"typescript\");\n\n            // 2. post initialize message to update editor\n            const jresImage = getJRESImageFromImageLiteral(imageString, arcadePalette);\n            this._item = jresImage\n            this.props.postMessage({type: \"initialize\", message: jresImage.data});\n        }, 50)\n\n    }\n\n    onClockwiseRotateButtonClick = () => {\n        this._transformImpl(this.rotateClockwise)\n    }\n\n    onCounterClockwiseRotateButtonClick = () => {\n        this._transformImpl(this.rotateCounterClockwise)\n    }\n\n    onHorizontalFlipButtonClick = () => {\n        this._transformImpl(this.horizontalFlip)\n    }\n\n    onVerticalFlipButtonClick = () => {\n        this._transformImpl(this.verticalFlip)\n    }\n\n    render() {\n        const {item} = this.state;\n\n        return <div id=\"image-toolbar\">\n            <div className=\"image-toolbar-buttons\">\n                <div className=\"image-button\" title=\"Rotate 90\" onClick={this.onClockwiseRotateButtonClick}>\n                    <i className=\"icon redo\"></i>\n                </div>\n                <div className=\"image-button\" title=\"Rotate 270\" onClick={this.onCounterClockwiseRotateButtonClick}>\n                    <i className=\"icon undo\"></i>\n                </div>\n                <div className=\"image-button\" title=\"Horizontal flip\" onClick={this.onHorizontalFlipButtonClick}>\n                    <i className=\"icon arrows alternate horizontal icon\"></i>\n                </div>\n                <div className=\"image-button\" title=\"Vertical flip\" onClick={this.onVerticalFlipButtonClick}>\n                    <i className=\"icon arrows alternate vertical icon\"></i>\n                </div>\n                <div className=\"image-button\" title=\"Copy to clipboard\" onClick={this.copyToClipboard}>\n                    <i className=\"icon copy outline\"></i>\n                </div>\n            </div>\n        </div>\n    }\n\n    private rotateClockwise(bitmap: Bitmap) {\n        let result = new Bitmap(bitmap.height, bitmap.width)\n        for (let w = 0; w < bitmap.width; w++) {\n            for (let h = 0; h < bitmap.height; h++) {\n                result.set(bitmap.height - 1 - h, w, bitmap.get(w, h))\n            }\n        }\n        return result\n    }\n\n    private rotateCounterClockwise(bitmap: Bitmap) {\n        let result = new Bitmap(bitmap.height, bitmap.width)\n        for (let w = 0; w < bitmap.width; w++) {\n            for (let h = 0; h < bitmap.height; h++) {\n                result.set(h, bitmap.width - 1 - w, bitmap.get(w, h))\n            }\n        }\n        return result\n    }\n\n    private verticalFlip(bitmap: Bitmap) {\n        let result = new Bitmap(bitmap.width, bitmap.height)\n        for (let h = 0; h < bitmap.height; h++) {\n            for (let w = 0; w < bitmap.width; w++) {\n                result.set(w, bitmap.height - 1 - h, bitmap.get(w, h))\n            }\n        }\n        return result\n    }\n\n    private horizontalFlip(bitmap: Bitmap) {\n        let result = new Bitmap(bitmap.width, bitmap.height)\n        for (let h = 0; h < bitmap.height; h++) {\n            for (let w = 0; w < bitmap.width; w++) {\n                result.set(bitmap.width - 1 - w, h, bitmap.get(w, h))\n            }\n        }\n        return result\n    }\n\n\n}\n\nexport default ImageToolbar\n","import React from 'react';\nimport './styles/App.css';\nimport ImageToolbar from \"./components/ImageToolbar\";\n\nclass App extends React.Component {\n    private iframe!: HTMLIFrameElement;\n    componentDidMount() {\n        this.iframe = document.getElementById(\"editor\") as HTMLIFrameElement;\n    }\n\n    postMessage = (data: any) => {\n        if (this.iframe && this.iframe.contentWindow) {\n            data[\"_fromVscode\"] = true; // fake _fromVscode for now\n            this.iframe.contentWindow.postMessage(data, \"*\");\n        }\n    }\n\n    onMouseEnter = () => {\n        this.iframe?.contentWindow?.focus();\n    }\n\n    render() {\n        return (\n            <div className=\"app\">\n                <iframe id=\"editor\"\n                        onMouseEnter={this.onMouseEnter}\n                        title=\"MakeCode Arcade sprite editor\"\n                        src=\"https://arcade.makecode.com/beta--asseteditor\"/>\n                <ImageToolbar postMessage={this.postMessage}/>\n            </div>\n        );\n    }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './styles/index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}